{% extends "base.html" %}
{% load filters %}

{% block title %} Exploit Detail {% endblock %}

{% block content %}

<script>
   var edit_exploit_name = "{% url 'crits-exploits-views-edit_exploit_name' exploit.id|urlencode %}";
   var update_exploit_cve = "{% url 'crits-exploits-views-edit_exploit_cve' %}";
   var exploit_id = "{{ exploit.id | escapejs}}";
</script>

<div id="tabnav" class="tabnav" style="font-size:90%">
    <ul style="font-size: 125%">
    <li><a href="#details_section" id="details_button"><span>Details</span></a></li>
    {% if ExploitACL.SERVICES_READ|has_access_to:user %}
      <li><a href="#analysis_section" id="analysis_button"><span>Analysis ({{ service_results|length }})</span></a></li>
      {% include 'services_tab_list_widget.html' %}
    {% endif %}
    </ul>

<div id="details_section">
    {% if ExploitACL.DELETE|has_access_to:user %}
    <span class="horizontal_menu">
    <ul class="hmenu">
          <li class="right"><a href="#" class="deleteClick" data-is-object="true" type="exploit" action='{% url "crits-exploits-views-remove_exploit" exploit.id %}'>Delete Exploit</a></li>
    </ul>
    </span>
    {% endif %}

    <div class="content_box content_details">
        <h3 class="titleheader">
            <span>Details for {{exploit.name}}</span>
        </h3>
        <div class="content_body">
            <table class="vertical" width="100%">
                <thead>
                </thead>
                <tbody>
                    <tr>
                        <td class="key">ID</td>
                        <td>{{exploit.id}}</td>
                    </tr>
                    <tr>
                        <td class="key">Name</td>
                        <td>
                            <span class="edit_underline" id="edit_exploit_name">{{exploit.name}}</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="key">CVE</td>
                        <td>{{exploit.cve}}</td>
                    </tr>
                    {% if ExploitACL.DESCRIPTION_READ|has_access_to:user %}
                    <tr>
                        {% with description=exploit.description %}
                            {% include 'description_widget.html' %}
                        {% endwith %}
                    </tr>
                    {% endif %}
                    <tr>
                        <td class="key">Created</td>
                        <td>{{exploit.created}}</td>
                    </tr>
                    <tr>
                        <td class="key">Modified</td>
                        <td>{{exploit.modified}}</td>
                    </tr>
                    {% if ExploitACL.STATUS_READ|has_access_to:user %}
                      <tr>
                          <td class="key">Status
                              <span style="float: right;" class="object_status_response"></span>
                          </td>
                          <td>
                              <span class="edit" id="object_status" action="{% url 'crits-core-views-update_status' subscription.type subscription.id %}">{{exploit.status}}</span>
                          </td>
                      </tr>
                    {% endif %}
                    {% with tlp=exploit.tlp %}
                        {% include "tlp_widget.html" %}
                    {% endwith %}
                    {% if ExploitACL.SECTORS_READ|has_access_to:user %}
                      {% with sectors=exploit.sectors %}
                          {% include "sector_widget.html" %}
                      {% endwith %}
                    {% endif %}
                    {% if ExploitACL.SOURCES_READ|has_access_to:user %}
                    <tr>
                        {% with sources=exploit.source obj_id=exploit.id obj_type=subscription.type %}
                            {% include "sources_listing_widget.html" %}
                        {% endwith %}
                    </tr>
                    {% endif %}
                    {% if ExploitACL.RELEASABILITY_READ|has_access_to:user %}
                    <tr>
                        {% with releasability=exploit.releasability %}
                            {% include "releasability_list_widget.html" %}
                        {% endwith %}
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div> <!-- content_body -->
     </div> <!-- content_box -->
     <div id="detail_floaters">
         {% include 'details_options_widget.html' %}
         {% if ExploitACL.BUCKETLIST_READ|has_access_to:user %}
           {% with bucket_list=exploit.bucket_list %}
               {% include 'bucket_list_widget.html' %}
           {% endwith %}
         {% endif %}
         {% include 'add_related_widget.html' %}
     </div>
     {% if ExploitACL.ACTIONS_READ|has_access_to:user %}
      <div class="content_box">
          {% with obj=exploit obj_type="Exploit" %}
              {% include 'action_listing_widget.html' %}
          {% endwith %}
     </div>
     {% endif %}
     {% if ExploitACL.TICKETS_READ|has_access_to:user %}
     <div>
	    {% with obj=exploit obj_type=subscription.type %}
                {% include 'tickets_listing_widget.html' %}
	    {% endwith %}
    </div>
    {% endif %}
    {% if ExploitACL.CAMPAIGNS_READ|has_access_to:user and ExploitACL.CAMPAIGN_READ|has_access_to:user %}
      <div>
          {% with hit=exploit col=COL_EXPLOITS %}
              {% include "campaigns_display_widget.html" %}
          {% endwith %}
      </div>
    {% endif %}
    {% if ExploitACL.RELATIONSHIPS_READ|has_access_to:user %}
      <div>
          {% include 'relationships_listing_widget.html' %}
      </div>
    {% endif %}
    {% if ExploitACL.OBJECTS_READ|has_access_to:user %}
      <div>
          {% include 'objects_listing_widget.html' %}
      </div>
    {% endif %}
    {% if ExploitACL.SCREENSHOTS_READ|has_access_to:user %}
      <div>
      {% include 'screenshot_widget.html' %}
      </div>
    {% endif %}
    {% if ExploitACL.COMMENTS_READ|has_access_to:user %}
      <div>
          {% include "comments_listing_widget.html" %}
      </div>
    {% endif %}
</div> <!-- details_section -->

{% if ExploitACL.SERVICES_READ|has_access_to:user %}
  {% with item=exploit %}
      {% include "services_analysis_section.html" with crits_type="Exploit" identifier=exploit.id %}
  {% endwith %}

  {% include 'services_tab_tabs_widget.html' %}
{% endif %}
</div>

<script type="text/javascript">
    $(document).bind('enable_exploit_cve', function(){
        window.add_exploit_aliases = true;
    });
</script>

{% endblock %}

{% block javascript_includes %}
<script type="text/javascript" src="{{ STATIC_URL }}js/exploits.js"></script>
{% endblock %}
