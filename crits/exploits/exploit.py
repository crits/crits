from mongoengine import Document, StringField
from django.conf import settings

from crits.exploits.migrate import migrate_exploit
from crits.core.crits_mongoengine import CritsBaseAttributes, CritsSourceDocument
from crits.core.crits_mongoengine import CritsActionsDocument

class Exploit(CritsBaseAttributes, CritsSourceDocument, CritsActionsDocument,
              Document):
    """
    Exploit class.
    """

    meta = {
        "collection": settings.COL_EXPLOITS,
        "crits_type": 'Exploit',
        "latest_schema_version": 2,
        "schema_doc": {
        },
        "jtable_opts": {
            'details_url': 'crits.exploits.views.exploit_detail',
            'details_url_key': 'id',
            'default_sort': "modified DESC",
            'searchurl': 'crits.exploits.views.exploits_listing',
            'fields': ["name", "cve", "description", "modified", "source",
                       "campaign", "status", "id"],
            'jtopts_fields': ["details", "name", "cve", "description",
                              "modified", "source", "campaign", "status",
                              "favorite", "id"],
            'hidden_fields': [],
            'linked_fields': ["source", "campaign"],
            'details_link': 'details',
            'no_sort': ['details'],
        }
    }

    name = StringField(required=True)
    cve = StringField()

    def migrate(self):
        migrate_exploit(self)