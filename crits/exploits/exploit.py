from mongoengine import Document, StringField, BooleanField
from mongoengine import EmbeddedDocument
from django.conf import settings

from crits.core.crits_mongoengine import (
    CommonAccess,
    CritsBaseAttributes,
    CritsSourceDocument,
    CritsDocumentFormatter
)

class Exploit(CritsBaseAttributes, CritsSourceDocument, Document):
    """
    Exploit class.
    """

    meta = {
        "collection": settings.COL_EXPLOITS,
        "crits_type": 'Exploit',
        "latest_schema_version": 1,
        "schema_doc": {
        },
        "jtable_opts": {
            'details_url': 'crits.exploits.views.exploit_detail',
            'details_url_key': 'id',
            'default_sort': "modified DESC",
            'searchurl': 'crits.exploits.views.exploits_listing',
            'fields': ["name", "cve", "description", "modified", "source",
                       "campaign", "status", "id"],
            'jtopts_fields': ["details", "name", "cve", "description",
                              "modified", "source", "campaign", "status",
                              "favorite", "id"],
            'hidden_fields': [],
            'linked_fields': ["source", "campaign"],
            'details_link': 'details',
            'no_sort': ['details'],
        }
    }

    name = StringField(required=True)
    cve = StringField()

    def migrate(self):
        pass


class ExploitAccess(EmbeddedDocument, CritsDocumentFormatter, CommonAccess):
    """
    ACL for Exploits.
    """

    description_edit = BooleanField(default=False)
